<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Cache Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f5f7fa;
            --dark: #333;
            --gray: #95a5a6;
            --border: #ddd;
            --hit-color: #d4edda;
            --hit-border: #c3e6cb;
            --miss-color: #f8d7da;
            --miss-border: #f5c6cb;
            --hover-bg: #eee;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: var(--dark);
            background-color: #f9f9f9;
        }
        
        .wrapper {
            max-width: 1300px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        h1, h2, h3, h4 {
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-top: 30px;
        }
        
        h3 {
            font-size: 1.3rem;
            margin-top: 20px;
        }
        
        p {
            margin-bottom: 15px;
        }
        
        .subheading {
            color: var(--gray);
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .card {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: box-shadow 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .card-header {
            background-color: var(--secondary);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            border-radius: 8px;
            background-color: white;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 150px;
            flex: 1;
        }
        
        .control-group.buttons {
            flex-direction: row;
            align-items: flex-end;
            gap: 10px;
        }
        
        label {
            font-weight: 600;
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        input, select {
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        button {
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        button i {
            font-size: 1rem;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-secondary {
            background-color: var(--light);
            color: var(--secondary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background-color: var(--hover-bg);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
            
            .control-group.buttons {
                flex-direction: column;
            }
        }
        
        .cache-visualization {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .cache-stats {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
            flex: 1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        .stat-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 5px 0;
        }
        
        .stat-card .label {
            font-size: 0.9rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-card.hits {
            border-top: 4px solid var(--success);
        }
        
        .stat-card.misses {
            border-top: 4px solid var(--danger);
        }
        
        .stat-card.rate {
            border-top: 4px solid var(--warning);
        }
        
        .cache-blocks {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .cache-block {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            background-color: white;
            transition: all 0.3s;
            position: relative;
        }
        
        .cache-block.hit {
            background-color: var(--hit-color);
            border-color: var(--hit-border);
            animation: pulse-hit 1s ease;
        }
        
        .cache-block.miss {
            background-color: var(--miss-color);
            border-color: var(--miss-border);
            animation: pulse-miss 1s ease;
        }
        
        .cache-block .index {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 0.8rem;
            color: var(--gray);
            background-color: rgba(255, 255, 255, 0.8);
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        .cache-block-address {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--secondary);
        }
        
        .cache-block-data {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .cache-block-data span {
            padding: 3px 6px;
            border-radius: 4px;
            background-color: #f5f5f5;
        }
        
        .cache-block.empty {
            background-color: #f9f9f9;
            border-style: dashed;
        }
        
        .cache-block.empty .cache-block-address {
            color: var(--gray);
        }
        
        @keyframes pulse-hit {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        
        @keyframes pulse-miss {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
        
        .access-history {
            margin-top: 20px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }
        
        .history-table thead {
            background-color: var(--secondary);
            color: white;
        }
        
        .history-table th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .history-table tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background-color 0.2s;
        }
        
        .history-table tbody tr:hover {
            background-color: #f5f5f5;
        }
        
        .history-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .history-table td {
            padding: 12px 15px;
            font-size: 0.95rem;
        }
        
        .history-table td.hit {
            color: var(--success);
            font-weight: 600;
        }
        
        .history-table td.miss {
            color: var(--danger);
            font-weight: 600;
        }
        
        .instruction-sequence {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .sequence-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sequence-title i {
            color: var(--primary);
        }
        
        .sequence-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .instruction-box {
            padding: 10px 15px;
            background-color: #f5f5f5;
            border-radius: 6px;
            font-family: monospace;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }
        
        .instruction-box:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab:hover {
            color: var(--primary);
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .explanation {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .explanation p {
            margin-bottom: 15px;
            line-height: 1.7;
        }
        
        .explanation ul, .explanation ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .explanation li {
            margin-bottom: 8px;
        }
        
        .policy-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            border-left: 4px solid var(--primary);
        }
        
        .policy-card:hover {
            transform: translateY(-3px);
        }
        
        .policy-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .policy-card p {
            margin-bottom: 0;
        }
        
        .footer {
            margin-top: 50px;
            padding: 20px 0;
            text-align: center;
            border-top: 1px solid var(--border);
            color: var(--gray);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--secondary);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--secondary) transparent transparent transparent;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .help-icon {
            color: var(--primary);
            font-size: 0.9rem;
            margin-left: 5px;
        }
        
        .help-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .help-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .help-content h3 {
            margin-top: 0;
        }
        
        .close-help {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--gray);
        }
        
        .close-help:hover {
            color: var(--danger);
        }
        
        .cache-animation {
            margin-top: 30px;
            text-align: center;
        }
        
        .cache-animation svg {
            max-width: 100%;
            height: auto;
        }
        
        .memory-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        
        .memory-box {
            width: 80%;
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .memory-box h4 {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .memory-blocks {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .memory-block {
            width: 60px;
            height: 60px;
            border: 1px solid var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
            background-color: white;
            border-radius: 6px;
        }
        
        .arrow {
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .tooltip-container {
            position: relative;
            display: inline-block;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .badge-success {
            background-color: var(--hit-color);
            color: #155724;
        }
        
        .badge-danger {
            background-color: var(--miss-color);
            color: #721c24;
        }

        .glossary-term {
            text-decoration: underline dotted;
            cursor: help;
            color: var(--primary);
        }
        
        .visual-guide {
            margin-top: 30px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--warning);
        }
        
        .visual-guide h3 {
            color: var(--warning);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .close-modal:hover {
            color: var(--danger);
        }

        .visual-guide-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .visual-step {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--light);
            border-left: 3px solid var(--primary);
        }

        .visual-step h4 {
            margin-bottom: 5px;
            color: var(--primary);
        }

        .animation-container {
            width: 100%;
            height: 300px;
            background-color: white;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        
        /* New styles for improved layout */
        .simulator-container {
            display: grid;
            grid-template-columns: 5fr 4fr;
            gap: 20px;
        }
        
        .simulator-controls {
            margin-right: 15px;
        }
        
        .clear-reset-btns {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
        }
        
        .clear-reset-btns button {
            margin-left: 10px;
        }
        
        .three-column-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
            border-top: 4px solid var(--primary);
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-card i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .feature-card h4 {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .visual-diagram {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .diagram-container {
            position: relative;
            height: 250px;
            margin: 20px 0;
        }
        
        .diagram-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .memory-hierarchy {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            width: 100%;
        }
        
        .hierarchy-level {
            width: 100%;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
            color: white;
        }
        
        .cpu-level {
            background-color: #3498db;
            width: 30%;
        }
        
        .l1-level {
            background-color: #2ecc71;
            width: 40%;
        }
        
        .l2-level {
            background-color: #f39c12;
            width: 60%;
        }
        
        .l3-level {
            background-color: #e74c3c;
            width: 80%;
        }
        
        .ram-level {
            background-color: #9b59b6;
            width: 100%;
        }
        
        .policy-comparison {
            margin-top: 30px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .comparison-table th, .comparison-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .comparison-table th {
            background-color: var(--secondary);
            color: white;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .comparison-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .step-animation {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        
        .animation-step {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            width: 100%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .step-number {
            background-color: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        
        .step-content {
            flex: 1;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        /* Responsive fixes */
        @media (max-width: 992px) {
            .three-column-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .simulator-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .three-column-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <header>
            <h1>Advanced Cache Simulator</h1>
            <div class="subheading">Interactive tool to visualize and understand cache replacement policies</div>
        </header>
        
        <div class="container">
            <div class="clear-reset-btns">
                <button id="clear-history-btn" class="btn-secondary">
                    <i class="fas fa-eraser"></i> Clear History
                </button>
                <button id="reset-btn" class="btn-danger">
                    <i class="fas fa-trash-alt"></i> Reset Cache
                </button>
            </div>
            
            <!-- Controls Card -->
            <div class="card">
                <div class="card-header">
                    <span><i class="fas fa-sliders-h"></i> Simulation Controls</span>
                    <button id="help-btn" class="btn-secondary"><i class="fas fa-question-circle"></i> Help</button>
                </div>
                <div class="card-body">
                    <div class="controls">
                        <div class="control-group">
                            <label for="cache-size">
                                Cache Size (blocks):
                                <span class="tooltip">
                                    <i class="fas fa-info-circle help-icon"></i>
                                    <span class="tooltip-text">Number of blocks that can be stored in the cache at once</span>
                                </span>
                            </label>
                            <input type="number" id="cache-size" min="1" max="16" value="4">
                        </div>
                        
                        <div class="control-group">
                            <label for="replacement-policy">
                                Replacement Policy:
                                <span class="tooltip">
                                    <i class="fas fa-info-circle help-icon"></i>
                                    <span class="tooltip-text">Algorithm used to decide which block to evict when cache is full</span>
                                </span>
                            </label>
                            <select id="replacement-policy">
                                <option value="lru">LRU (Least Recently Used)</option>
                                <option value="fifo">FIFO (First In First Out)</option>
                                <option value="lfu">LFU (Least Frequently Used)</option>
                                <option value="random">Random</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="memory-address">
                                Memory Address:
                                <span class="tooltip">
                                    <i class="fas fa-info-circle help-icon"></i>
                                    <span class="tooltip-text">Address to access in memory (0-255)</span>
                                </span>
                            </label>
                            <input type="number" id="memory-address" min="0" max="255" value="0">
                        </div>
                        
                        <div class="control-group buttons">
                            <button id="access-btn" class="btn-primary">
                                <i class="fas fa-memory"></i> Access Memory
                            </button>
                            <button id="run-sequence-btn" class="btn-secondary">
                                <i class="fas fa-play"></i> Run Sequence
                            </button>
                        </div>
                    </div>
                    
                    <div class="instruction-sequence">
                        <div class="sequence-title">
                            <i class="fas fa-list-ol"></i> Predefined Access Sequences
                        </div>
                        <div class="sequence-container">
                            <div class="instruction-box" data-sequence="0,1,2,3,0,1,4,0,1,2,3,4">Sequential</div>
                            <div class="instruction-box" data-sequence="1,6,1,11,1,16,1,21,1,26">Stride Pattern</div>
                            <div class="instruction-box" data-sequence="5,2,7,9,1,3,8,4,5,10">Random Access</div>
                            <div class="instruction-box" data-sequence="1,2,3,4,1,2,5,1,2,3,4,5">Loop Pattern</div>
                            <div class="instruction-box" data-sequence="10,11,12,13,20,21,22,23,10,11,12,13">Burst Pattern</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Simulator Container -->
            <div class="simulator-container">
                <!-- Cache Visualization -->
                <div class="card">
                    <div class="card-header">
                        <span><i class="fas fa-microchip"></i> Cache Visualization</span>
                        <div>
                            <span id="animation-speed-label">Animation Speed: Normal</span>
                            <input type="range" id="animation-speed" min="1" max="5" value="3" style="margin-left: 10px;">
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="cache-visualization">
                            <div class="cache-stats">
                                <div class="stat-card hits">
                                    <div class="label">Cache Hits</div>
                                    <div class="value" id="hits-counter">0</div>
                                </div>
                                <div class="stat-card misses">
                                    <div class="label">Cache Misses</div>
                                    <div class="value" id="misses-counter">0</div>
                                </div>
                                <div class="stat-card rate">
                                    <div class="label">Hit Rate</div>
                                    <div class="value" id="hit-rate">0%</div>
                                </div>
                            </div>
                            
                            <h3>Cache Contents</h3>
                            <div class="cache-blocks" id="cache-blocks-container">
                                <!-- Cache blocks will be generated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Access History -->
                <div class="card">
                    <div class="card-header">
                        <span><i class="fas fa-history"></i> Access History</span>
                    </div>
                    <div class="card-body">
                        <div class="access-history">
                            <table class="history-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Address</th>
                                        <th>Result</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="history-table-body">
                                    <!-- History entries will be added dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Explanation Tabs -->
            <div class="card">
                <div class="card-header">
                    <span><i class="fas fa-book"></i> Cache Learning Resources</span>
                </div>
                <div class="card-body">
                    <div class="tabs">
                        <div class="tab active" data-tab="concepts">
                            <i class="fas fa-brain"></i> Key Concepts
                        </div>
                        <div class="tab" data-tab="policies">
                            <i class="fas fa-exchange-alt"></i> Replacement Policies
                        </div>
                        <div class="tab" data-tab="visual">
                            <i class="fas fa-project-diagram"></i> Visual Guide
                        </div>
                    </div>
                    
                    <div class="tab-content active" id="concepts-tab">
                        <div class="explanation">
                            <h3>Cache Memory Fundamentals</h3>
                            <p>Cache memory is a small, fast memory that sits between the CPU and main memory. It stores copies of frequently used data to reduce access time and improve performance. When the processor needs to read from or write to a memory location, it first checks the cache.</p>
                            
                            <h4>How Cache Works</h4>
                            <ul>
                                <li><strong>Cache Hit</strong>: When the requested data is found in the cache, resulting in faster access.</li>
                                <li><strong>Cache Miss</strong>: When the requested data is not in the cache, requiring a fetch from main memory.</li>
                                <li><strong>Block/Line</strong>: The unit of data transfer between cache and main memory.</li>
                                <li><strong>Eviction</strong>: The process of removing a block from the cache to make room for a new block.</li>
                            </ul>
                            
                            <h4>Cache Performance Metrics</h4>
                            <ul>
                                <li><strong>Hit Rate</strong>: Percentage of memory accesses found in the cache.</li>
                                <li><strong>Miss Rate</strong>: Percentage of memory accesses not found in the cache.</li>
                                <li><strong>Average Memory Access Time</strong>: Average time to access memory accounting for both hits and misses.</li>
                            </ul>
                            
                            <h4>Cache Types</h4>
                            <ul>
                                <li><strong>Direct-Mapped Cache</strong>: Each memory block can go in exactly one location in the cache.</li>
                                <li><strong>Fully Associative Cache</strong>: A memory block can be placed in any cache line (this simulator).</li>
                                <li><strong>Set-Associative Cache</strong>: A compromise between direct-mapped and fully associative.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="policies-tab">
                        <div class="policy-comparison">
                            <h3>Cache Replacement Policies</h3>
                            <p>When the cache is full and a new block needs to be brought in, a replacement policy decides which existing block to evict.</p>
                            
                            <table class="comparison-table">
                                <thead>
                                    <tr>
                                        <th>Policy</th>
                                        <th>Description</th>
                                        <th>Advantages</th>
                                        <th>Disadvantages</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>LRU</strong></td>
                                        <td>Replaces the block that was used least recently</td>
                                        <td>Good temporal locality, better hit rates for most workloads</td>
                                        <td>More complex to implement in hardware, requires tracking access history</td>
                                    </tr>
                                    <tr>
                                        <td><strong>FIFO</strong></td>
                                        <td>Replaces the block that was loaded first (oldest)</td>
                                        <td>Simple to implement, low overhead</td>
                                        <td>Does not consider frequency of use, lower hit rates than LRU</td>
                                    </tr>
                                    <tr>
                                        <td><strong>LFU</strong></td>
                                        <td>Replaces the block that has been accessed least frequently</td>
                                        <td>Works well when certain blocks are accessed very frequently</td>
                                        <td>Can retain old, frequently-used blocks too long</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Random</strong></td>
                                        <td>Randomly selects a block to replace</td>
                                        <td>Very simple to implement, no tracking needed</td>
                                        <td>Unpredictable performance, generally worse hit rates</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div class="policy-card">
                                <h4>Choosing the Right Policy</h4>
                                <p>The best replacement policy depends on the memory access patterns of your application. LRU often performs well for general-purpose applications with good temporal locality, while specialized workloads might benefit from other policies.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="visual-tab">
                        <div class="visual-guide">
                            <h3>Visual Guide to Cache Operation</h3>
                            <p>Follow this visual guide to understand the cache operations step by step.</p>
                            
                            <div class="visual-guide-content">
                                <div class="visual-step">
                                    <h4>Step 1: Memory Address Lookup</h4>
                                    <p>When the CPU requests data, it sends a memory address to the cache controller.</p>
                                </div>
                                
                                <div class="visual-step">
                                    <h4>Step 2: Cache Check</h4>
                                    <p>The cache controller checks if the requested address is present in the cache.</p>
                                </div>
                                
                                <div class="visual-step">
                                    <h4>Step 3A: Cache Hit</h4>
                                    <p>If the data is found in the cache, it's returned to the CPU immediately (cache hit).</p>
                                </div>
                                
                                <div class="visual-step">
                                    <h4>Step 3B: Cache Miss</h4>
                                    <p>If the data is not in cache, it's fetched from main memory (cache miss).</p>
                                </div>
                                
                                <div class="visual-step">
                                    <h4>Step 4: Cache Update</h4>
                                    <p>After a miss, the new data is stored in the cache. If the cache is full, the replacement policy decides which block to evict.</p>
                                </div>
                            </div>
                            
                            <div class="memory-hierarchy">
                                <h4>Memory Hierarchy</h4>
                                <div class="hierarchy-level cpu-level">CPU</div>
                                <div class="arrow"><i class="fas fa-arrow-down"></i></div>
                                <div class="hierarchy-level l1-level">L1 Cache</div>
                                <div class="arrow"><i class="fas fa-arrow-down"></i></div>
                                <div class="hierarchy-level l2-level">L2 Cache</div>
                                <div class="arrow"><i class="fas fa-arrow-down"></i></div>
                                <div class="hierarchy-level l3-level">L3 Cache</div>
                                <div class="arrow"><i class="fas fa-arrow-down"></i></div>
                                <div class="hierarchy-level ram-level">Main Memory (RAM)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Advanced Cache Simulator © 2023 | Educational Tool for Understanding Cache Memory and Replacement Policies</p>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div class="help-section" id="help-modal">
        <div class="help-content">
            <div class="close-help" id="close-help"><i class="fas fa-times"></i></div>
            <h3>How to Use the Cache Simulator</h3>
            
            <h4>Basic Operations</h4>
            <ol>
                <li><strong>Configure the cache</strong>: Set the cache size and replacement policy.</li>
                <li><strong>Access memory</strong>: Enter a memory address (0-255) and click "Access Memory".</li>
                <li><strong>Run sequences</strong>: Click one of the predefined sequences or click "Run Sequence" after inputting your own addresses.</li>
                <li><strong>Reset cache</strong>: Click "Reset Cache" to clear all cache data and statistics.</li>
                <li><strong>Clear history</strong>: Click "Clear History" to clear the access history log.</li>
            </ol>
            
            <h4>Understanding the Visualization</h4>
            <ul>
                <li><strong>Green highlight</strong>: Indicates a cache hit.</li>
                <li><strong>Red highlight</strong>: Indicates a cache miss.</li>
                <li><strong>Empty blocks</strong>: Shown with dashed borders and labeled as "Empty".</li>
                <li><strong>Block data</strong>: Shows the memory address currently stored in that block.</li>
            </ul>
            
            <h4>Replacement Policies</h4>
            <ul>
                <li><strong>LRU (Least Recently Used)</strong>: Replaces the block that hasn't been accessed for the longest time.</li>
                <li><strong>FIFO (First In First Out)</strong>: Replaces the block that was loaded first (oldest block).</li>
                <li><strong>LFU (Least Frequently Used)</strong>: Replaces the block that has been accessed the least number of times.</li>
                <li><strong>Random</strong>: Randomly selects a block to replace.</li>
            </ul>
            
            <h4>Tips for Learning</h4>
            <ul>
                <li>Try different replacement policies with the same sequence to compare their effectiveness.</li>
                <li>Observe how different access patterns affect the hit rate for each policy.</li>
                <li>Adjust the cache size to see how it impacts performance.</li>
                <li>Check the access history to understand the sequence of operations and their results.</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Cache configuration
            let cacheSize = parseInt(document.getElementById('cache-size').value);
            let replacementPolicy = document.getElementById('replacement-policy').value;
            let cacheBlocks = [];
            let accessHistory = [];
            let hits = 0;
            let misses = 0;
            let animationSpeed = parseInt(document.getElementById('animation-speed').value);
            
            // DOM Elements
            const cacheSizeInput = document.getElementById('cache-size');
            const policySelect = document.getElementById('replacement-policy');
            const memoryAddressInput = document.getElementById('memory-address');
            const accessBtn = document.getElementById('access-btn');
            const runSequenceBtn = document.getElementById('run-sequence-btn');
            const resetBtn = document.getElementById('reset-btn');
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            const cacheBlocksContainer = document.getElementById('cache-blocks-container');
            const historyTableBody = document.getElementById('history-table-body');
            const hitsCounter = document.getElementById('hits-counter');
            const missesCounter = document.getElementById('misses-counter');
            const hitRateDisplay = document.getElementById('hit-rate');
            const animationSpeedInput = document.getElementById('animation-speed');
            const animationSpeedLabel = document.getElementById('animation-speed-label');
            const helpBtn = document.getElementById('help-btn');
            const helpModal = document.getElementById('help-modal');
            const closeHelpBtn = document.getElementById('close-help');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const instructionBoxes = document.querySelectorAll('.instruction-box');
            
            // Initialize cache blocks
            function initializeCache() {
                cacheBlocks = [];
                for (let i = 0; i < cacheSize; i++) {
                    cacheBlocks.push({
                        valid: false,
                        address: null,
                        data: null,
                        lastAccessed: -1,
                        accessCount: 0,
                        loadTime: -1
                    });
                }
                renderCache();
            }
            
            // Render cache blocks
            function renderCache() {
                cacheBlocksContainer.innerHTML = '';
                for (let i = 0; i < cacheBlocks.length; i++) {
                    const block = cacheBlocks[i];
                    const blockElement = document.createElement('div');
                    blockElement.className = block.valid ? 'cache-block' : 'cache-block empty';
                    
                    // Block content
                    let blockContent = `
                        <div class="index">Block ${i}</div>
                        <div class="cache-block-address">${block.valid ? 'Address: ' + block.address : 'Empty'}</div>
                        <div class="cache-block-data">
                    `;
                    
                    if (block.valid) {
                        blockContent += `
                            <span>Last Used: ${block.lastAccessed}</span>
                            <span>Access Count: ${block.accessCount}</span>
                            <span>Load Time: ${block.loadTime}</span>
                        `;
                    }
                    
                    blockContent += `</div>`;
                    blockElement.innerHTML = blockContent;
                    cacheBlocksContainer.appendChild(blockElement);
                }
            }
            
            // Update statistics
            function updateStats() {
                hitsCounter.textContent = hits;
                missesCounter.textContent = misses;
                const total = hits + misses;
                const hitRate = total > 0 ? ((hits / total) * 100).toFixed(1) : '0';
                hitRateDisplay.textContent = hitRate + '%';
            }
            
            // Add history entry
            function addHistoryEntry(address, isHit, action) {
                const entryIndex = accessHistory.length + 1;
                accessHistory.push({ address, isHit, action });
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${entryIndex}</td>
                    <td>${address}</td>
                    <td class="${isHit ? 'hit' : 'miss'}">${isHit ? 'HIT' : 'MISS'}</td>
                    <td>${action}</td>
                `;
                historyTableBody.appendChild(row);
                // Scroll to bottom of history table
                historyTableBody.parentNode.scrollTop = historyTableBody.parentNode.scrollHeight;
            }
            
            // Find block by address
            function findBlockByAddress(address) {
                return cacheBlocks.findIndex(block => block.valid && block.address === address);
            }
            
            // Find replacement candidate
            function findReplacementCandidate() {
                let candidateIndex = -1;
                
                switch (replacementPolicy) {
                    case 'lru':
                        // Find least recently used
                        let minLastAccessed = Infinity;
                        for (let i = 0; i < cacheBlocks.length; i++) {
                            if (cacheBlocks[i].lastAccessed < minLastAccessed) {
                                minLastAccessed = cacheBlocks[i].lastAccessed;
                                candidateIndex = i;
                            }
                        }
                        break;
                        
                    case 'fifo':
                        // Find first loaded
                        let minLoadTime = Infinity;
                        for (let i = 0; i < cacheBlocks.length; i++) {
                            if (cacheBlocks[i].loadTime < minLoadTime) {
                                minLoadTime = cacheBlocks[i].loadTime;
                                candidateIndex = i;
                            }
                        }
                        break;
                        
                    case 'lfu':
                        // Find least frequently used
                        let minAccessCount = Infinity;
                        for (let i = 0; i < cacheBlocks.length; i++) {
                            if (cacheBlocks[i].accessCount < minAccessCount) {
                                minAccessCount = cacheBlocks[i].accessCount;
                                candidateIndex = i;
                            }
                        }
                        break;
                        
                    case 'random':
                        // Random selection
                        candidateIndex = Math.floor(Math.random() * cacheBlocks.length);
                        break;
                }
                
                return candidateIndex;
            }
            
            // Find empty block
            function findEmptyBlock() {
                return cacheBlocks.findIndex(block => !block.valid);
            }
            
            // Access memory
            async function accessMemory(address) {
                const currentTime = accessHistory.length;
                let isHit = false;
                let action = '';
                
                // Check if the block is in cache
                const blockIndex = findBlockByAddress(address);
                
                if (blockIndex !== -1) {
                    // Cache hit
                    isHit = true;
                    action = 'Cache hit';
                    hits++;
                    
                    // Update block metadata
                    cacheBlocks[blockIndex].lastAccessed = currentTime;
                    cacheBlocks[blockIndex].accessCount++;
                    
                    // Show cache hit animation
                    await animateCacheAccess(blockIndex, true);
                } else {
                    // Cache miss
                    isHit = false;
                    misses++;
                    
                    // Find where to place the new block
                    let emptyBlockIndex = findEmptyBlock();
                    if (emptyBlockIndex !== -1) {
                        // Empty block available
                        action = 'Loaded into empty block';
                        cacheBlocks[emptyBlockIndex] = {
                            valid: true,
                            address: address,
                            data: `Data for address ${address}`,
                            lastAccessed: currentTime,
                            accessCount: 1,
                            loadTime: currentTime
                        };
                        
                        // Show cache miss animation
                        await animateCacheAccess(emptyBlockIndex, false);
                    } else {
                        // Need to replace a block
                        const replacementIndex = findReplacementCandidate();
                        const replacedAddress = cacheBlocks[replacementIndex].address;
                        action = `Replaced block with address ${replacedAddress}`;
                        
                        cacheBlocks[replacementIndex] = {
                            valid: true,
                            address: address,
                            data: `Data for address ${address}`,
                            lastAccessed: currentTime,
                            accessCount: 1,
                            loadTime: currentTime
                        };
                        
                        // Show cache miss and replacement animation
                        await animateCacheAccess(replacementIndex, false);
                    }
                }
                
                // Update UI
                renderCache();
                updateStats();
                addHistoryEntry(address, isHit, action);
            }
            
            // Animate cache access
            async function animateCacheAccess(blockIndex, isHit) {
                return new Promise(resolve => {
                    const blocks = document.querySelectorAll('.cache-block');
                    if (blocks[blockIndex]) {
                        blocks[blockIndex].classList.add(isHit ? 'hit' : 'miss');
                        
                        // Calculate delay based on animation speed (1-5)
                        // 5 is fastest (100ms), 1 is slowest (500ms)
                        const delay = 600 - (animationSpeed * 100);
                        
                        setTimeout(() => {
                            blocks[blockIndex].classList.remove('hit', 'miss');
                            resolve();
                        }, delay);
                    } else {
                        resolve();
                    }
                });
            }
            
            // Handle access memory button click
            accessBtn.addEventListener('click', function() {
                const address = parseInt(memoryAddressInput.value);
                if (isNaN(address) || address < 0 || address > 255) {
                    alert('Please enter a valid memory address (0-255)');
                    return;
                }
                accessMemory(address);
            });
            
            // Handle run sequence button click
            runSequenceBtn.addEventListener('click', async function() {
                const address = parseInt(memoryAddressInput.value);
                if (isNaN(address) || address < 0 || address > 255) {
                    alert('Please enter a valid memory address (0-255)');
                    return;
                }
                
                // Disable buttons during sequence
                accessBtn.disabled = true;
                runSequenceBtn.disabled = true;
                resetBtn.disabled = true;
                clearHistoryBtn.disabled = true;
                
                // Access the same memory address 5 times
                for (let i = 0; i < 5; i++) {
                    await accessMemory(address);
                }
                
                // Re-enable buttons
                accessBtn.disabled = false;
                runSequenceBtn.disabled = false;
                resetBtn.disabled = false;
                clearHistoryBtn.disabled = false;
            });
            
            // Handle instruction box clicks
            instructionBoxes.forEach(box => {
                box.addEventListener('click', async function() {
                    const sequence = this.dataset.sequence.split(',').map(Number);
                    
                    // Disable buttons during sequence
                    accessBtn.disabled = true;
                    runSequenceBtn.disabled = true;
                    resetBtn.disabled = true;
                    clearHistoryBtn.disabled = true;
                    
                    for (const address of sequence) {
                        await accessMemory(address);
                    }
                    
                    // Re-enable buttons
                    accessBtn.disabled = false;
                    runSequenceBtn.disabled = false;
                    resetBtn.disabled = false;
                    clearHistoryBtn.disabled = false;
                });
            });
            
            // Handle reset button click
            resetBtn.addEventListener('click', function() {
                hits = 0;
                misses = 0;
                initializeCache();
                updateStats();
            });
            
            // Handle clear history button click
            clearHistoryBtn.addEventListener('click', function() {
                accessHistory = [];
                historyTableBody.innerHTML = '';
            });
            
            // Handle cache size change
            cacheSizeInput.addEventListener('change', function() {
                cacheSize = parseInt(this.value);
                if (cacheSize < 1) cacheSize = 1;
                if (cacheSize > 16) cacheSize = 16;
                this.value = cacheSize;
                
                hits = 0;
                misses = 0;
                initializeCache();
                updateStats();
            });
            
            // Handle replacement policy change
            policySelect.addEventListener('change', function() {
                replacementPolicy = this.value;
            });
            
            // Handle animation speed change
            animationSpeedInput.addEventListener('input', function() {
                animationSpeed = parseInt(this.value);
                const speedLabels = ['Very Slow', 'Slow', 'Normal', 'Fast', 'Very Fast'];
                animationSpeedLabel.textContent = `Animation Speed: ${speedLabels[animationSpeed - 1]}`;
            });
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabName}-tab`).classList.add('active');
                });
            });
            
            // Help modal
            helpBtn.addEventListener('click', function() {
                helpModal.style.display = 'flex';
            });
            
            closeHelpBtn.addEventListener('click', function() {
                helpModal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === helpModal) {
                    helpModal.style.display = 'none';
                }
            });
            
            // Initialize the cache
            initializeCache();
        });
    </script>
</body>
</html>